import{p as He,d as ve,r as Ze,c as j,a as x,g as $e,o as be,b as xe,e as ye,f as Le,h as a,i as F,u as y,w as g,v,j as Je,F as Ke,k as Qe,l as _e,m as O,n as et,q as tt,s as nt,t as lt,x as at,y as it,z,A as ot,B as ke,C as st}from"./index-Bm6JTdea.js";function K(I,C){return[I,C]}K.invert=K;function dt(){return He(K).scale(152.63)}const ut={class:"flex flex-col"},rt={class:"flex items-start p-4 gap-4"},ct={class:"flex flex-col items-center w-[600px] gap-4"},ft={class:"flex flex-col gap-4"},ht={class:"w-[320px] shrink-0"},mt={class:"sticky top-4 flex flex-col gap-4 max-h-[calc(100vh-2rem)] overflow-auto"},pt={class:"border rounded-xl p-3"},gt={class:"flex items-center gap-2 mb-2"},wt={class:"mb-2"},vt={class:"flex items-center gap-2 ml-4"},bt={class:"flex items-center gap-2 ml-4"},xt={class:"flex items-center gap-2 ml-4"},yt={class:"flex items-center gap-2 ml-4"},Lt={class:"flex items-center gap-2 ml-4"},kt={class:"flex items-center gap-2 ml-4"},Mt={class:"border rounded-xl p-3"},Pt={class:"flex items-center gap-2 mb-2"},St={class:"flex items-center gap-2 mb-3"},At={class:"flex items-center gap-2"},It=["value"],Ct=3.5,Ut=ve({__name:"GlobeView",setup(I,{expose:C}){const d=Ze({x11:!0,tailwindChroma:!1,tailwindGray:!1,tailwindLines:!1,places:!1,land:!0,graticuleAxis:!0,textName:!0}),M={places:"places",tailwindChroma:"tailwind.chroma",tailwindGray:"tailwind.gray",x11:"x11",land:"globe.land",graticule:"globe.graticule",axis:"globe.axis"},P=j(()=>{const e=[];return d.x11&&e.push("x11"),d.tailwindChroma&&e.push("tailwind.chroma"),d.tailwindGray&&e.push("tailwind.gray"),d.places&&e.push("places"),d.land&&e.push("globe.land"),d.graticuleAxis&&e.push("globe.graticule","globe.axis"),d.textName&&e.push("text.name"),e}),B=j(()=>d.tailwindLines),T=j(()=>d.textName),W=x(!0),q=$e(),p=x(0),Q=x(23.5),S=x(!1);function G(e){S.value=e}const Me=[{label:"0°/s (stop)",value:0},{label:"3°/s",value:3},{label:"6°/s",value:6},{label:"12°/s",value:12},{label:"24°/s",value:24},{label:"48°/s",value:48}],Y=x(12),X=new Set;function Pe(e){return X.add(e),()=>X.delete(e)}let A=null,U=0;function _(e){U||(U=e);const n=e-U;U=e,S.value||(p.value=(p.value+Y.value*(n/1e3))%360),X.forEach(i=>i()),A=requestAnimationFrame(_)}function Se(){A==null&&(A=requestAnimationFrame(_))}function Ae(){A!=null&&(cancelAnimationFrame(A),A=null,U=0)}be(()=>Se()),xe(()=>Ae());const N=ve({name:"CanvasPanel",props:{mode:{type:String,required:!0},title:{type:String,default:""},centerLon:{type:Number,required:!0},tiltLat:{type:Number,default:0},width:{type:Number,required:!0},height:{type:Number,required:!0},points:{type:Array,required:!0},checkedIds:{type:Array,required:!0},groupIndex:{type:Object,required:!0},connectTailwindLines:{type:Boolean,default:!1},paused:{type:Boolean,default:!1},showName:{type:Boolean,default:!0},showBackside:{type:Boolean,default:!1}},emits:["update:centerLon","update:tiltLat","pause"],setup(e,{emit:n}){const i=_e();O(i,()=>E());const R=window.devicePixelRatio||1;function Ie(t,l,s){const o=Math.round(l*R),r=Math.round(s*R);(t.width!==o||t.height!==r)&&(t.width=o,t.height=r),t.style.width=l+"px",t.style.height=s+"px"}function Ce(t,l){t.save(),t.scale(R,R),l(),t.restore()}let H=!0;function E(){H=!0}function Ue(){H&&(H=!1,ze())}const L=x(null),ee=x(null),{x:te,y:ne}=et({target:L}),{pressed:le}=tt({target:L});let ae=0,ie=0,oe=0,se=0,D=.8;const Ne=.5,Ve=8,je=nt().step([30,15])(),de=at,Be=lt(de,de.objects.land).features,Te=j(()=>new Set(e.checkedIds)),b=t=>{const l=e.groupIndex[t];return l?Te.value.has(l):!1},ue=j(()=>{const t={};for(const l of e.points){if(l.group!=="tailwindGray"&&l.group!=="tailwindChroma")continue;const s=/^([^\s-]+)-(\d+)$/.exec(l.name);if(!s)continue;const o=s[1],r=parseInt(s[2],10);t[o]||(t[o]=[]),t[o].push({p:l,step:r})}for(const l of Object.keys(t))t[l].sort((s,o)=>s.step-o.step);return t}),re=x([]);O([ue,i],()=>{const t=ue.value,l=[];for(const s of Object.keys(t)){const o=t[s];if(!o.length)continue;const r=o.find(m=>m.step===500)?.p.hex??o[Math.floor(o.length/2)]?.p.hex??(i.value?"#aaa":"#666");l.push({color:r,points:o.map(m=>m.p)})}re.value=l},{immediate:!0});function qe(t){const l=t.find(o=>o.group==="axis"&&o.geo.lat>0),s=t.find(o=>o.group==="axis"&&o.geo.lat<0);return!l||!s?[]:[{color:"gray",points:[l,s]}]}function ce(t,l,s){for(const o of s){t.strokeStyle=o.color,t.lineWidth=e.mode==="map"?1:1.2,t.globalAlpha=.8;let r=!1,m=null,c=null;t.beginPath();for(const h of o.points){const f=fe(h.geo,l);if(!f)continue;const[u,w]=f,k=Ye(h.geo.lon);if(!r)t.moveTo(u,w),r=!0;else{let V=!1;e.mode==="map"&&m!==null&&(We(k,m)>179.5&&(V=!0),!V&&c!==null&&Math.abs(u-c)>e.width*.5&&(V=!0)),V?t.moveTo(u,w):t.lineTo(u,w)}m=k,c=u}t.stroke(),t.globalAlpha=1}}function Ge(t){return((t+180)%360+360)%360-180}function Re(t,l,s,o){t.beginPath(),t.fillStyle=i.value?"#aaa8":"#6668",t.font="12px monospace",t.textAlign="left",t.textBaseline="middle",t.fillText(l,s+6,o)}function Ee(t){const{lat:l,lon:s,r:o}=t,r=l*Math.PI/180,m=s*Math.PI/180;let c=o*Math.cos(r)*Math.sin(m),h=o*Math.sin(r),f=o*Math.cos(r)*Math.cos(m);const u=e.centerLon*Math.PI/180;{const $=c*Math.cos(u)+f*Math.sin(u),J=-c*Math.sin(u)+f*Math.cos(u);c=$,f=J}const k=(e.mode==="globe"?e.tiltLat:e.mode==="polar"?90:0)*Math.PI/180;{const $=h*Math.cos(k)-f*Math.sin(k),J=h*Math.sin(k)+f*Math.cos(k);h=$,f=J}if(e.mode==="globe"&&!e.showBackside&&f<=0)return null;const Z=Math.min(e.width,e.height)/600*280*(e.mode==="globe"?D:1),we=e.width/2,Xe=e.height/2;return[we+c*Z,Xe-h*Z]}function De(){return Math.min(e.width,e.height)/600*280}function Fe(){if(e.mode==="globe")return ke().rotate([e.centerLon,-e.tiltLat,0]).translate([e.width/2,e.height/2]).scale(De()*D).clipAngle(90);const t=e.mode==="map",l=e.mode==="polar"?[e.centerLon,-90,0]:[e.centerLon,0,0];return(t?dt():ke()).rotate(l).translate([e.width/2,e.height/2]).scale(t?95:140)}function Oe(t){const l=[];return e.showName&&l.push(t.name),l.join(" · ")}function ze(){const t=ee.value;if(!t)return null;Ie(t,e.width,e.height);const l=t.getContext("2d");return l?Ce(l,()=>{const s=Fe(),o=ot(s,l);l.clearRect(0,0,e.width,e.height);const r=(i.value,"#9996"),m=(i.value,"#9996");if(b("land")&&(l.fillStyle=r,l.beginPath(),o({type:"FeatureCollection",features:Be}),l.fill()),b("graticule")&&(l.strokeStyle=m,l.lineWidth=1,l.beginPath(),o(je),l.stroke()),b("axis")){const c=qe(e.points);ce(l,s,c)}if(e.connectTailwindLines&&(b("tailwindGray")||b("tailwindChroma"))){const h=new Set;b("tailwindGray")&&h.add("tailwindGray"),b("tailwindChroma")&&h.add("tailwindChroma");const f=re.value.map(u=>({...u,points:u.points.filter(w=>h.has(w.group))})).filter(u=>u.points.length>=2);ce(l,s,f)}for(const c of e.points){if(!b(c.group))continue;const h=fe(c.geo,s);if(!h)continue;const[f,u]=h;l.beginPath(),l.fillStyle=c.hex,l.globalAlpha=.95,l.arc(f,u,Ct,0,Math.PI*2),l.fill(),l.globalAlpha=1;const w=Oe(c);w&&Re(l,w,f,u)}return s}):null}function fe(t,l){if(e.mode==="map"){const s=Math.asin(t.r*Math.sin(t.lat*Math.PI/180))*180/Math.PI,o=l([t.lon,s]);return o?[o[0],o[1]]:null}else return Ee(t)}function We(t,l){return Math.abs(((t-l+180)%360+360)%360-180)}const Ye=t=>((t-e.centerLon+180)%360+360)%360-180;O(le,t=>n("pause",t));function he(){ae=te.value,ie=ne.value,oe=e.centerLon,se=e.tiltLat}it(()=>{if(!le.value)return;const t=te.value-ae,l=ne.value-ie,s=t*.5;if(n("update:centerLon",Ge(oe+s)),e.mode==="globe"){const o=l*.5,r=Math.max(-90,Math.min(90,se+o));n("update:tiltLat",r)}});function me(t){if(e.mode!=="globe")return;t.preventDefault();const l=t.deltaY>0?-.1:.1;D=Math.max(Ne,Math.min(Ve,D+l)),E()}function pe(){n("pause",!1)}let ge=null;return be(()=>{L.value?.addEventListener("mousedown",he),L.value?.addEventListener("wheel",me,{passive:!1}),window.addEventListener("mouseup",pe),ge=Pe(Ue),E()}),xe(()=>{L.value?.removeEventListener("mousedown",he),L.value?.removeEventListener("wheel",me),window.removeEventListener("mouseup",pe),ge?.()}),O(()=>[e.checkedIds,e.centerLon,e.tiltLat,e.mode,e.width,e.height,e.connectTailwindLines,e.showName,i.value],()=>E(),{deep:!0}),()=>z("div",{class:"inline-block"},[z("div",{ref:L,class:"border relative bg-white dark:bg-black rounded",style:{width:e.width+"px",height:e.height+"px"}},[e.title?z("div",{class:"absolute top-1 right-2 font-bold text-sm bg-white/70 dark:bg-black/50 px-1 rounded"},e.title):null,z("canvas",{ref:ee,width:e.width,height:e.height,style:{position:"absolute",inset:0}})])])}});return C({CanvasPanel:N}),(e,n)=>(Le(),ye("div",ut,[a("div",rt,[a("div",ct,[F(y(N),{title:"Globe",mode:"globe",width:600,height:600,points:y(q),"checked-ids":P.value,"group-index":M,"connect-tailwind-lines":B.value,"center-lon":p.value,"onUpdate:centerLon":n[0]||(n[0]=i=>p.value=i),"tilt-lat":Q.value,"onUpdate:tiltLat":n[1]||(n[1]=i=>Q.value=i),paused:S.value,onPause:G,"show-name":T.value,"show-backside":W.value},null,8,["points","checked-ids","connect-tailwind-lines","center-lon","tilt-lat","paused","show-name","show-backside"]),F(y(N),{title:"Map",mode:"map",width:600,height:300,points:y(q),"checked-ids":P.value,"group-index":M,"connect-tailwind-lines":B.value,"center-lon":p.value,"onUpdate:centerLon":n[2]||(n[2]=i=>p.value=i),paused:S.value,onPause:G,"show-name":T.value},null,8,["points","checked-ids","connect-tailwind-lines","center-lon","paused","show-name"])]),a("div",ft,[F(y(N),{title:"Polar",mode:"polar",width:300,height:300,points:y(q),"checked-ids":P.value,"group-index":M,"connect-tailwind-lines":B.value,"center-lon":p.value,"onUpdate:centerLon":n[3]||(n[3]=i=>p.value=i),paused:S.value,onPause:G,"show-name":T.value},null,8,["points","checked-ids","connect-tailwind-lines","center-lon","paused","show-name"]),F(y(N),{title:"Equator",mode:"equator",width:300,height:300,points:y(q),"checked-ids":P.value,"group-index":M,"connect-tailwind-lines":B.value,"center-lon":p.value,"onUpdate:centerLon":n[4]||(n[4]=i=>p.value=i),paused:S.value,onPause:G,"show-name":T.value},null,8,["points","checked-ids","connect-tailwind-lines","center-lon","paused","show-name"])]),a("aside",ht,[a("div",mt,[a("div",pt,[n[24]||(n[24]=a("div",{class:"font-semibold mb-2"},"Objects",-1)),a("label",gt,[g(a("input",{type:"checkbox","onUpdate:modelValue":n[5]||(n[5]=i=>d.x11=i)},null,512),[[v,d.x11]]),n[15]||(n[15]=a("span",null,"x11 colors",-1))]),a("div",wt,[n[19]||(n[19]=a("div",{class:"text-sm opacity-70 mb-1"},"tailwind",-1)),a("label",vt,[g(a("input",{type:"checkbox","onUpdate:modelValue":n[6]||(n[6]=i=>d.tailwindChroma=i)},null,512),[[v,d.tailwindChroma]]),n[16]||(n[16]=a("span",null,"chroma",-1))]),a("label",bt,[g(a("input",{type:"checkbox","onUpdate:modelValue":n[7]||(n[7]=i=>d.tailwindGray=i)},null,512),[[v,d.tailwindGray]]),n[17]||(n[17]=a("span",null,"gray",-1))]),a("label",xt,[g(a("input",{type:"checkbox","onUpdate:modelValue":n[8]||(n[8]=i=>d.tailwindLines=i)},null,512),[[v,d.tailwindLines]]),n[18]||(n[18]=a("span",null,"lines",-1))])]),a("div",null,[n[23]||(n[23]=a("div",{class:"text-sm opacity-70 mb-1"},"globe",-1)),a("label",yt,[g(a("input",{type:"checkbox","onUpdate:modelValue":n[9]||(n[9]=i=>d.places=i)},null,512),[[v,d.places]]),n[20]||(n[20]=a("span",null,"places",-1))]),a("label",Lt,[g(a("input",{type:"checkbox","onUpdate:modelValue":n[10]||(n[10]=i=>d.land=i)},null,512),[[v,d.land]]),n[21]||(n[21]=a("span",null,"land",-1))]),a("label",kt,[g(a("input",{type:"checkbox","onUpdate:modelValue":n[11]||(n[11]=i=>d.graticuleAxis=i)},null,512),[[v,d.graticuleAxis]]),n[22]||(n[22]=a("span",null,"graticule & axis",-1))])])]),a("div",Mt,[n[28]||(n[28]=a("div",{class:"font-semibold mb-2"},"Options",-1)),a("label",Pt,[g(a("input",{type:"checkbox","onUpdate:modelValue":n[12]||(n[12]=i=>d.textName=i)},null,512),[[v,d.textName]]),n[25]||(n[25]=a("span",null,"show name",-1))]),a("label",St,[g(a("input",{type:"checkbox","onUpdate:modelValue":n[13]||(n[13]=i=>W.value=i)},null,512),[[v,W.value]]),n[26]||(n[26]=a("span",null,"show backside objects",-1))]),a("div",At,[n[27]||(n[27]=a("span",{class:"text-sm opacity-70"},"speed",-1)),g(a("select",{"onUpdate:modelValue":n[14]||(n[14]=i=>Y.value=i),class:"border rounded px-2 py-1 bg-white dark:bg-black"},[(Le(),ye(Ke,null,Qe(Me,i=>a("option",{key:i.value,value:i.value},st(i.label),9,It)),64))],512),[[Je,Y.value]])])])])])])]))}}),Nt=(I,C)=>{const d=I.__vccOpts||I;for(const[M,P]of C)d[M]=P;return d},Bt=Nt(Ut,[["__scopeId","data-v-fcee226c"]]);export{Bt as default};
